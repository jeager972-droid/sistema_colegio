<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Informaci√≥n Estudiante</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2>Informaci√≥n del Estudiante</h2>

    <form id="info-form">
        <div class="row mt-4">
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="ti_est" placeholder="TI">
            </div>
            <div class="col-md-6 mb-3">
                <input type="date" class="form-control" id="birth_date_est">
            </div>
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="phone_est" placeholder="Tel√©fono">
            </div>
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="eps_est" placeholder="EPS">
            </div>
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="mom_name" placeholder="Acudiente">
            </div>
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="phone_mon" placeholder="Tel√©fono acudiente">
            </div>
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="cc_mom" placeholder="C√©dula acudiente">
            </div>
        </div>

        <button class="btn btn-success w-100">Guardar</button>
    </form>

    <div id="status" class="mt-3"></div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const student_id = params.get("student_id");

// üîπ Cargar datos si existen
async function loadStudent() {
    const res = await fetch(`/info/get?student_id=${student_id}`);
    const data = await res.json();

    if (data) {
        document.getElementById('ti_est').value = data.ti_est || '';
        document.getElementById('birth_date_est').value = data.birth_date_est || '';
        document.getElementById('phone_est').value = data.phone_est || '';
        document.getElementById('eps_est').value = data.eps_est || '';
        document.getElementById('mom_name').value = data.mom_name || '';
        document.getElementById('phone_mon').value = data.phone_mon || '';
        document.getElementById('cc_mom').value = data.cc_mom || '';
    }
}

loadStudent();

// üîπ Guardar o actualizar
document.getElementById('info-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = {
        student_id,
        ti_est: document.getElementById('ti_est').value,
        birth_date_est: document.getElementById('birth_date_est').value,
        phone_est: document.getElementById('phone_est').value,
        eps_est: document.getElementById('eps_est').value,
        mom_name: document.getElementById('mom_name').value,
        phone_mon: document.getElementById('phone_mon').value,
        cc_mom: document.getElementById('cc_mom').value
    };

    const res = await fetch('/info/save', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
    });

    const result = await res.json();
    document.getElementById('status').innerText =
        result.success ? "‚úÖ Guardado correctamente" : "‚ùå Error";
});
</script>

</body>
</html>
