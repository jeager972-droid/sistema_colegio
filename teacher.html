<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel Profesor</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container mt-5">

    <h2 class="mb-4"> Lista de Estudiantes</h2>

    <button class="btn btn-primary mb-3" onclick="loadStudents()">Cargar Estudiantes</button>

    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Nombre</th>
                <th>Acci贸n</th>
            </tr>
        </thead>
        
        <tbody id="students-table"></tbody>
    </table>

    <hr>

    <div id="student-form-container" style="display:none;">
        <h4> Informaci贸n del Estudiante</h4>

        <form id="edit-form">
            <input type="hidden" id="student_id">

            <div class="row">
                <div class="col-md-6 mb-3">
                    <input type="text" id="ti_est" class="form-control" placeholder="TI">
                </div>
                <div class="col-md-6 mb-3">
                    <input type="date" id="birth_date_est" class="form-control">
                </div>
                <div class="col-md-6 mb-3">
                    <input type="text" id="phone_est" class="form-control" placeholder="Tel茅fono estudiante">
                </div>
                <div class="col-md-6 mb-3">
                    <input type="text" id="eps_est" class="form-control" placeholder="EPS">
                </div>
                <div class="col-md-6 mb-3">
                    <input type="text" id="mom_name" class="form-control" placeholder="Nombre acudiente">
                </div>
                <div class="col-md-6 mb-3">
                    <input type="text" id="phone_mon" class="form-control" placeholder="Tel茅fono acudiente">
                </div>
                <div class="col-md-6 mb-3">
                    <input type="text" id="cc_mom" class="form-control" placeholder="C茅dula acudiente">
                </div>
            </div>

            <button class="btn btn-success w-100">Guardar Cambios</button>
        </form>

        <div id="status" class="mt-3"></div>
    </div>

</div>




<script>

async function loadStudents() {
    const res = await fetch('/students/list?classroom_id=1');
    const data = await res.json();

    const tbody = document.getElementById('students-table');
    tbody.innerHTML = '';

    async function loadStudents() {
    const res = await fetch('/students/list?classroom_id=1');
    const data = await res.json();

    const tbody = document.querySelector('#students-table tbody');
    tbody.innerHTML = '';

    data.forEach(student => {
        tbody.innerHTML += `
            <tr>
                <td>${student.name}</td>
                <td>
                    <button class="btn btn-sm btn-info"
                        onclick="viewStudent(${student.id})">
                        Ver informaci贸n
                    </button>
                </td>
            </tr>
        `;
    });
}

    
    async function viewStudent(id) {
    
      const res = await fetch('/student/info/' + id);
      const result = await res.json();
    
      if (!result.success) {
        alert("No se encontr贸 informaci贸n");
        return;
      }
    
      const data = result.data;
    
      const formHTML = `
      <div class="container mt-4">
        <h4>${data.full_name}</h4>
        <input type="hidden" id="student_id" value="${id}">
        <input class="form-control mb-2" id="ti_est" placeholder="TI"
          value="${data.ti_est || ''}">
        <input class="form-control mb-2" type="date" id="birth_date_est"
          value="${data.birth_date_est || ''}">
        <input class="form-control mb-2" id="phone_est"
          value="${data.phone_est || ''}">
        <input class="form-control mb-2" id="eps_est"
          value="${data.eps_est || ''}">
        <input class="form-control mb-2" id="mom_name"
          value="${data.mom_name || ''}">
        <input class="form-control mb-2" id="phone_mon"
          value="${data.phone_mon || ''}">
        <input class="form-control mb-2" id="cc_mom"
          value="${data.cc_mom || ''}">
        <button class="btn btn-success"
          onclick="saveStudent()">Guardar</button>
      </div>
      `;
    
      document.body.innerHTML = formHTML;
    }
    
    async function saveStudent() {
    
      const formData = {
        student_id: document.getElementById('student_id').value,
        ti_est: document.getElementById('ti_est').value,
        birth_date_est: document.getElementById('birth_date_est').value,
        phone_est: document.getElementById('phone_est').value,
        eps_est: document.getElementById('eps_est').value,
        mom_name: document.getElementById('mom_name').value,
        phone_mon: document.getElementById('phone_mon').value,
        cc_mom: document.getElementById('cc_mom').value
      };
    
      const res = await fetch('/info/save', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });
    
      const data = await res.json();
    
      if (data.success) {
        alert("Guardado correctamente");
        location.reload();
      } else {
        alert("Error guardando");
      }
    }
    
    </script>
    